groups:
  - name: production_log_alerts
    rules:
      - alert: LogErrorDetected
        expr: |
          sum by (message, container) (
            count_over_time(
              {container=~".+", container!="ui"} 
              |~ "(?i)(\"level\":\"error\"|\\[error\\]|level=error)"
              | regexp "(?P<message>.*)" 
              [1m]
            )
          ) > 0
        for: 0m
        labels:
          severity: critical
          source: loki
        annotations:
          summary: "Error Log detected on Production ({{ $labels.container }})"
          description: "{{ $labels.message }}"